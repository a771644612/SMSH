webpackJsonp([6],{179:function(e,t,a){"use strict";function r(e){a(509)}Object.defineProperty(t,"__esModule",{value:!0});var n=a(301),s=a(515),i=a(70),o=r,l=i(n.a,s.a,!1,o,"data-v-56885768",null);t.default=l.exports},301:function(e,t,a){"use strict";var r=a(511);t.a={components:{OrderTable:r.a},mounted:function(){this.$store.commit("setLoadingStatus",!1)}}},302:function(e,t,a){"use strict";t.a={data:function(){return{loading:!1,index:1,pageSize:10,orderAmount:0,orders:[],status_0_checked:!0,status_1_checked:!0,status_2_checked:!0,status_3_checked:!0,dialogFormVisible:!1,filterChanged:!1,exporting:!1,shipping_order:{},keyword:"",keywords:[{value:"time",label:"订单时间"},{value:"address",label:"收货地址"},{value:"state",label:"订单状态"},{value:"wx_id",label:"微信 ID"},{value:"order_id",label:"订单号"}]}},watch:{status_0_checked:function(){this.filterChanged=!0},status_1_checked:function(){this.filterChanged=!0},status_2_checked:function(){this.filterChanged=!0},status_3_checked:function(){this.filterChanged=!0},keyword:function(){this.filterChanged=!0},filterChanged:function(e){e&&(this.filterChanged=!1,this.index=1)}},mounted:function(){this.refreshPage()},methods:{getOrderAmount:function(){var e=this,t={state_0:this.status_0_checked?1:0,state_1:this.status_1_checked?1:0,state_2:this.status_2_checked?1:0,state_3:this.status_3_checked?1:0,pagesize:0,index:0};this.$http.post(this.$store.state.host+"/adminpannel/Orders",t,{emulateJSON:!0}).then(function(t){e.util.sessionCheck(e,t.body.code)&&200===t.body.code?e.orderAmount=e.util.toValidNumber(t.body.info):e.$message.error("获取订单总数失败")},this.util.returnFailHandler)},modifiedOrder:function(e){return e.hasOwnProperty("name")&&(e.book_info={id:e.book_id,ISBN:e.ISBN,name:e.name,left:e.left}),e},getOrders:function(){var e=this;this.getOrderAmount();var t={state_0:this.status_0_checked?1:0,state_1:this.status_1_checked?1:0,state_2:this.status_2_checked?1:0,state_3:this.status_3_checked?1:0,order_by:this.keyword,pagesize:this.pageSize,index:this.index};this.$http.post(this.$store.state.host+"/adminpannel/Orders",t,{emulateJSON:!0}).then(function(t){e.util.sessionCheck(e,t.body.code)&&200===t.body.code?(e.$message({message:"获取订单信息成功",type:"success"}),e.orders=t.body.info):e.$message.error("未知错误，请联系系统管理员")},this.util.returnFailHandler)},refreshPage:function(){this.status_0_checked=!0,this.status_1_checked=!0,this.status_2_checked=!0,this.status_3_checked=!0,this.dialogFormVisible=!1,this.keyword="",this.shipping_order={},this.getOrders()},openForm:function(e){this.dialogFormVisible=!0,this.shipping_order=e},shipOrder:function(e){var t=this,a={order_id:e.id,tracking_number:e.tracking_number};this.$http.post(this.$store.state.host+"/adminpannel/Orders/complete",a,{emulateJSON:!0}).then(function(e){t.util.sessionCheck(t,e.body.code)&&200===e.body.code?(t.shipping_order.tracking_number="",t.dialogFormVisible=!1,t.$message({message:"发货成功",type:"success"}),t.getOrders()):429===e.body.code?t.$message({message:"该订单需要填写运单号，或该订单奖品已被删除",type:"warning"}):t.$message.error("未知错误，请联系系统管理员")},this.util.returnFailHandler)},order_state_switcher:function(e){switch(e){case 0:return"待发货";case 1:return"待收货";case 2:return"待评价";case 3:return"已评价"}},rewards_type_switcher:function(e){switch(e){case"0":return"书籍";case"1":return"奖品";case"2":return"积分"}},rewards_back_switcher:function(e){if(e.hasOwnProperty("reward_info"))switch(e.reward_info.rewards_type){case"1":return"奖品："+e.reward_info.rewards_back;case"2":return"积分："+e.reward_info.rewards_back;case"0":return"书籍：《"+e.reward_info.book_info.name+"》";default:return""}else if(e.hasOwnProperty("reward_id"))return"奖品已删除";return"书籍：《"+e.book_info.name+"》"},handleSizeChange:function(e){this.pageSize=e,this.getOrders()},handleCurrentChange:function(e){this.getOrders()},exportData:function(){var e=this,t={state_0:this.status_0_checked?1:0,state_1:this.status_1_checked?1:0,state_2:this.status_2_checked?1:0,state_3:this.status_3_checked?1:0};this.$http.post(this.$store.state.host+"/adminpannel/Orders/getAll",t,{emulateJSON:!0}).then(function(t){if(e.util.sessionCheck(e,t.body.code)&&200===t.body.code){e.exporting=!0;var a=t.body.info;e.$notify({title:"获取订单信息成功",message:"正在导出，请耐心等待...",type:"success"}),e.json2csv(a)}else e.$message.error("获取订单信息失败，请联系系统管理员")},this.util.returnFailHandler)},json2csv:function(e){var t=this,a="data:text/csv;charset=utf-8,\ufeff",r=["id","订单号","消耗积分","时间","订单状态","收货地址","运单号","订单类别","奖品标题","奖品类型","奖品信息","书籍id","书籍ISBN","书籍名"],n=r.join(",");a+=n+"\n",e.forEach(function(e){var r="";r+=e.id+",",r+=e.order_id+",",r+=e.price+",",r+=new Date(1e3*e.time).toLocaleString()+",",r+=t.order_state_switcher(e.state)+",",r+='"'+e.address.replace(/"/g,'""')+'",',e.hasOwnProperty("tracking_number")&&null!=e.tracking_number?r+='"'+e.tracking_number.replace(/"/g,'""')+'",':r+=",",e.hasOwnProperty("reward_id")&&-1!=e.reward_id?(r+="活动奖品,",null==e.reward_info.rewards_title?r+=",":r+='"'+e.reward_info.rewards_title.replace(/"/g,'""')+'",',r+=t.rewards_type_switcher(e.reward_info.rewards_type)+",",r+='"'+t.rewards_back_switcher(e).replace(/"/g,'""')+'",'):e.hasOwnProperty("reward_id")?r+="活动奖品,奖品已删除,,,":r+="积分兑换,,,,",e.hasOwnProperty("book_info")?(r+=e.book_info.id+",",r+='"'+e.book_info.ISBN.replace(/"/g,'""')+'",',r+='"'+e.book_info.name.replace(/"/g,'""')+'"'):e.hasOwnProperty("reward_info")&&e.reward_info.hasOwnProperty("book_info")?0===e.reward_info.book_info.id?r+="书籍已删除,书籍已删除,书籍已删除":(r+=e.reward_info.book_info.id+",",r+='"'+e.reward_info.book_info.ISBN.replace(/"/g,'""')+'",',r+='"'+e.reward_info.book_info.name.replace(/"/g,'""')+'"'):r+=",,",a+=r+"\n"}),this.exporting=!1,console.log("exporting..");var s=document.createElement("a"),i=encodeURI(a);s.href=i,s.download="data.csv",s.click(),window.URL.revokeObjectURL(i)}}}},509:function(e,t,a){var r=a(510);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(46)("7dce1326",r,!0,{})},510:function(e,t,a){t=e.exports=a(45)(!1),t.push([e.i,"",""])},511:function(e,t,a){"use strict";function r(e){a(512)}var n=a(302),s=a(514),i=a(70),o=r,l=i(n.a,s.a,!1,o,"data-v-27569e3a",null);t.a=l.exports},512:function(e,t,a){var r=a(513);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(46)("28febdbe",r,!0,{})},513:function(e,t,a){t=e.exports=a(45)(!1),t.push([e.i,".demo-table-expand[data-v-27569e3a]{font-size:0}.demo-table-expand label[data-v-27569e3a]{width:90px;color:#99a9bf}.demo-table-expand .el-form-item[data-v-27569e3a]{margin-right:0;margin-bottom:0;width:50%}.el-form-item__label[data-v-27569e3a]{color:#99a9bf}.container[data-v-27569e3a]{background-color:#aaccffaa;padding:20px}.table-expand[data-v-27569e3a]{font-size:0}.bg-white[data-v-27569e3a]{background:#fff}.grid-content[data-v-27569e3a]{border-radius:4px;min-height:40px;padding:5px 20px;margin:10px 0}.row-margin[data-v-27569e3a]{margin:1em}.table-expand label[data-v-27569e3a]{width:90px;color:#99a9bf}.table-expand .el-form-item[data-v-27569e3a]{margin-right:0;margin-bottom:0;width:60%;padding-left:80px;text-align:left}.table-wrapper[data-v-27569e3a]{background-color:#e0ffff;padding:10px;width:auto}.upper-tools[data-v-27569e3a]{margin-bottom:20px;padding-top:auto}.tools-unit[data-v-27569e3a]{text-align:center;vertical-align:middle}.bottom-pagination[data-v-27569e3a]{margin-top:20px;text-align:center}",""])},514:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"upper-tools"},[a("div",{staticClass:"grid-content bg-white"},[a("el-row",{staticClass:"row-margin"},[a("el-col",{attrs:{span:24}},[a("div",[a("span",[e._v("订单状态：")]),e._v(" "),a("el-checkbox",{attrs:{label:"待发货",border:""},model:{value:e.status_0_checked,callback:function(t){e.status_0_checked=t},expression:"status_0_checked"}}),e._v(" "),a("el-checkbox",{attrs:{label:"待收货",border:""},model:{value:e.status_1_checked,callback:function(t){e.status_1_checked=t},expression:"status_1_checked"}}),e._v(" "),a("el-checkbox",{attrs:{label:"待评价",border:""},model:{value:e.status_2_checked,callback:function(t){e.status_2_checked=t},expression:"status_2_checked"}}),e._v(" "),a("el-checkbox",{attrs:{label:"已评价",border:""},model:{value:e.status_3_checked,callback:function(t){e.status_3_checked=t},expression:"status_3_checked"}})],1)])],1),e._v(" "),a("el-row",{staticClass:"row-margin"},[a("el-col",{attrs:{span:24}},[a("div",[a("span",[e._v("排序方式：")]),e._v(" "),a("el-select",{attrs:{clearable:"",placeholder:"选择排序关键字"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},e._l(e.keywords,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])}))],1)])],1),e._v(" "),a("el-row",{staticClass:"row-margin"},[a("el-col",{attrs:{span:24}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-refresh"},nativeOn:{click:function(t){return e.refreshPage(t)}}},[e._v("刷新页面")]),e._v(" "),e.exporting?a("el-button",{attrs:{type:"info",disabled:"",icon:"el-icon-loading"}},[e._v("正在导出..")]):a("el-button",{attrs:{type:"info",icon:"el-icon-document"},nativeOn:{click:function(t){return e.exportData(t)}}},[e._v("导出订单")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},nativeOn:{click:function(t){return e.getOrders(t)}}},[e._v("筛选订单")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"",data:e.orders,"tooltip-effect":"dark","max-height":"600"}},[a("el-table-column",{attrs:{type:"expand",label:"更多信息",fixed:"left",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"订单 ID："}},[a("span",[e._v(e._s(t.row.order_id))])]),e._v(" "),a("el-form-item",{attrs:{label:"微信 ID："}},[a("span",[e._v(e._s(t.row.wx_id))])]),e._v(" "),t.row.hasOwnProperty("book_info")?[a("el-form-item",{attrs:{label:"书名："}},[a("span",[e._v(e._s(t.row.book_info.name))])])]:t.row.hasOwnProperty("reward_info")?[a("el-form-item",{attrs:{label:"奖品标题："}},[a("span",[e._v(e._s(t.row.reward_info.rewards_title))])])]:[a("el-form-item",{attrs:{label:"奖品标题："}},[a("span",[e._v("奖品已删除")])])]],2)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单时间",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(new Date(1e3*t.row.time).toLocaleString())+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单类别",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.hasOwnProperty("reward_id")?"活动奖品":"积分兑换")+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"收货地址",prop:"address",align:"center","header-align":"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"订单内容",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.hasOwnProperty("book_info")?"primary":"success"}},[e._v("\n                        "+e._s(e.rewards_back_switcher(t.row))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"运单号",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.hasOwnProperty("tracking_number")?a("span",[e._v(e._s(t.row.tracking_number))]):a("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[e._v("未填写订单号")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"订单状态",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.state>1?"primary":0==t.row.state?"info":"success"}},[e._v("\n                        "+e._s(e.order_state_switcher(t.row.state))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"180","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",disabled:t.row.state>0,icon:t.row.state>0?"el-icon-sold-out":"el-icon-edit"},nativeOn:{click:function(a){e.openForm(t.row)}}},[e._v("\n                                "+e._s((t.row.state,"发货"))+"\n                    ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"bottom-pagination"},[a("el-pagination",{attrs:{fixed:"",background:"","current-page":e.index,"page-size":e.pageSize,"page-sizes":[10,15,25],layout:"total, sizes, prev, pager, next, jumper",total:e.orderAmount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.index=t}}})],1),e._v(" "),e.dialogFormVisible?a("el-dialog",{attrs:{title:"发货",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.shipping_order,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"订单号："}},[a("span",[e._v(e._s(e.shipping_order.order_id))])]),e._v(" "),a("el-form-item",{attrs:{label:"发送地址："}},[a("span",[e._v(e._s(e.shipping_order.address))])]),e._v(" "),a("el-form-item",{attrs:{label:"发送奖品："}},[a("span",[e._v(e._s(e.rewards_back_switcher(e.shipping_order)))])]),e._v(" "),a("el-form-item",{attrs:{label:"运单号："}},[a("el-input",{attrs:{placeholder:"请输入运单号（非实物订单可忽略）"},model:{value:e.shipping_order.tracking_number,callback:function(t){e.$set(e.shipping_order,"tracking_number",t)},expression:"shipping_order.tracking_number"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.shipOrder(e.shipping_order)}}},[e._v("确 定")])],1)],1):e._e()],1)},n=[],s={render:r,staticRenderFns:n};t.a=s},515:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("order-table")],1)},n=[],s={render:r,staticRenderFns:n};t.a=s}});